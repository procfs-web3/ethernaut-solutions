// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "src/Contract.sol";
import "src/Exploit.sol";
import "src/DreamToken.sol";

contract ExploitTest is Test {

    Exploit exploit;
    Level5 level;
    IDreamToken token;
    address eoa;

    function setUp() public {
        level = new Level5();
        exploit = new Exploit(address(level));
        eoa = address(0x11223344);
    }

    function testExploit() public {
        vm.startPrank(eoa, eoa);
        vm.deal(eoa, 100 ether);
        exploit.fire1{value: 5 ether}();
        assertEq(exploit.getKingVotes(), 55);

        uint bn = block.number;
        vm.roll(bn + 1);
        bn += 1;
        exploit.fire2();

        vm.roll(bn + 2);
        bn += 2;
        exploit.fire3();

        vm.roll(bn + 20);
        bn += 20;
        exploit.fire4();

        vm.warp(10 minutes);
        exploit.fire5(eoa);

        assertEq(level.flag(), true, "exploit failed");
    }
}